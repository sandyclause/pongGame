<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Bounce game</title>
    <link rel="stylesheet" href="styles/styles.css">
</head>
<body>
    <main>
        <div class="ball"></div>
        <div class="result"></div>
        <div class="paddle"></div>
    </main>
    





<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>

<script>

    $(function () {


        init();

        function init(){
            //add balls
            let randomTimer = (Math.floor(Math.random()*3) * 1000);
            setInterval(function(){
                $('main').append(`<div class="ball"></div>`);
                ballAddClass();
                requestAnimationFrame(repeatOften);
                
            }, 5000);
        };



//loop through balls to add unique classname
        let lastBall;

        function ballAddClass() {
             
            $('.ball').each(function (index, ball) {
                $(ball).addClass('ball' + index);
                // console.log('ball' + index);
                lastBall = index;
                // console.log($('.ball'+index).attr('class').match(/ball\d+/));

            });

            //randomly position ball
            randomStart();
        };



//random ball starting position
        function randomStart() {
            let x = Math.floor(Math.random() * 500);
            $('.ball' + lastBall).css('left', x + 'px');

        };

//collision function
        function collisionCheck(){
            let n = $('.ball').length;
            for(let i = 0; i < n; i++){
                let dynamicBall = ('.ball' + i);
                //get the cords of the ball and paddle
                setCords(dynamicBall);

                var ball = $(dynamicBall).data('coordinates');
                var paddle = $('.paddle').data('coordinates');
                if(isCollide(ball, paddle)){
                    moveBack(dynamicBall);
                } 
                else{
                    move(dynamicBall);
                }

                deleteBall(ball.y, dynamicBall);

            }
                // console.log(ball.y, ball);
        };

//check if ball has passed boundaries. if so, delete ball
        function deleteBall(item, itemSelf){
 
            if(item > 500){
                $(itemSelf).remove();
                console.log('removed');
                console.log(itemSelf);
            }
        }


//constant check collision status
        function repeatOften(){
            collisionCheck();
            requestAnimationFrame(repeatOften);
        };

//setting the x and y values
        function setCords(ball){

            $(ball).data('coordinates', {
                x: $(ball).offset().left,
                y: $(ball).offset().top,
                height: $(ball).outerHeight(),
                width: $(ball).outerWidth()
            });
   
            $('.paddle').data('coordinates', {
                x: $('.paddle').offset().left,
                y: $('.paddle').offset().top,
                height: $('.paddle').outerHeight(),
                width: $('.paddle').outerWidth()
            });        
        };

//set interval
//request animation

        function move(ball){
            // $('.ball').animate({top: '+=50'},5000);    
            $(ball).css('top', '+=1');       
        };

        function moveBack(ball) {
            const onTop = parseInt($(ball).css('top'),10);
            if(onTop >= 0){
                $(ball).animate({ top: '0px' }, 5000);   

            }
        };        

// collision function
        function isCollide(a, b) {
            return !(
                ((a.y + a.height) < (b.y)) ||
                (a.y > (b.y + b.height)) ||
                ((a.x + a.width) < b.x) ||
                (a.x > (b.x + b.width))
            );
        };

//mouse as paddle

        $(document).on('mousemove', function(e){
            $('.paddle').css('top', e.pageY);
            $('.paddle').css('left', e.pageX);
        });

//hide mouse
        $('body').css('cursor', 'none');

    });//end of doc ready


</script>    



    
<script>

    // https://stackoverflow.com/users/2051938/mixeroid

</script>
</body>
</html>